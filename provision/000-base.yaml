---
- name: Installation base
  hosts: all
  tasks:

    - name: Create user
      user:
        name: "{{ user_name }}"
        uid: 1000
        group: users
        groups: power,storage,wheel
        append: yes

    - name: Install pacman-contrib
      pacman:
        name: pacman-contrib

    - name: Create mirrorlist backup
      copy:
        src: /etc/pacman.d/mirrorlist
        dest: /etc/pacman.d/mirrorlist.backup
        remote_src: yes
      when: false # TODO idempotence

    - name: Rank mirrorlist
      command: "rankmirrors -n 6 /etc/pacman.d/mirrorlist.backup > /etc/pacman.d/mirrorlist"
      when: false # TODO idempotence

    - name: Install X
      pacman:
        name:
          - xf86-video-intel
          - xorg
          - plasma

    - name: Enable X
      service:
        name: "{{ item }}"
        enabled: yes
      loop:
        - sddm
        - NetworkManager

    - name: Install necessary packages
      pacman:
        name:
          - dolphin
          - leafpad
          - spectacle
          - okular
          - gwenview
          - terminator
          - vlc
          - unzip
          - ark
          - bluedevil
          - bluez
          - bluez-libs
          - bluez-utils
          - pulseaudio-bluetooth
          - the_silver_searcher
          - nextcloud-client
          - htop
          - cups
          - libcups
          - print-manager
          - bind-tools
          - wget
          - git
          - rsync
          - nfs-utils
          - usbutils
          - python-virtualenv
          - emacs
          - btop
